<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skylon Joinery - Production Manager</title>
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
    <script>
        const SUPABASE_URL = 'https://iszkquzpoktokmkjmuuq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlzemtxdXpwb2t0b2tta2ptdXVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0Mzg3NTksImV4cCI6MjA2ODAxNDc1OX0.hijtNZIitJkc3BIQsYUkUTi3_l8OlCGSiJZdM9G3ywA';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        console.log('Supabase ready:', supabaseClient);
        
       
    </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="app-title">Skylon Joinery - Production Manager</div>
            <div class="navigation-links">
                <a href="pipeline.html" class="nav-link nav-link-pipeline">üìÑ Pipeline</a>
            </div>
            <div class="phases-legend" id="phasesLegend">
                <!-- Phases will be added here -->
            </div>
            <button class="add-phase-btn" onclick="openPhaseManager()">+ Manage Phases</button>
        </div>

        <!-- TUTAJ DALEJ TOOLBAR ITD... -->






        <!-- Toolbar -->
        <div class="toolbar">
            <button class="toolbar-btn primary" onclick="addProject()" id="addProjectBtn">+ Add Project</button>
            <button class="toolbar-btn" onclick="openDaysOffModal()">üìÖ Days Off</button>
            <button class="toolbar-btn success" onclick="openMoveToArchiveModal()">üì¶ Move to Archive</button>
            <button class="toolbar-btn" onclick="shiftWeek(-1)">‚Üê Week</button>
            <button class="toolbar-btn" onclick="shiftWeek(1)">Week ‚Üí</button>
<!-- Przyciski sortowania -->
<div style="width: 1px; height: 20px; background: #555; margin: 0 10px;"></div>
<span style="font-size: 11px; color: #999; margin-right: 8px;">Sort:</span>
<button class="toolbar-btn sort-btn" data-sort="number" onclick="setSortMode('number')" title="Sortuj wed≈Çug numeru">
    üî¢ By Number
</button>
<button class="toolbar-btn sort-btn" data-sort="deadline" onclick="setSortMode('deadline')" title="Sortuj wed≈Çug Deadline">
    üìÖ By DL
</button>

            
            <div class="export-dropdown">
                <button class="toolbar-btn">Export ‚ñº</button>
                <div class="export-menu">
                    <button onclick="exportJSON()">Export JSON</button>
                    <button onclick="exportCSV()">Export CSV</button>
                    <button onclick="importJSON()">Import JSON</button>
                </div>
            </div>

            <button class="toolbar-btn danger" onclick="clearAll()">Clear All</button>
            
            <button class="toolbar-btn" onclick="window.location.href='clients.html'" style="margin-left: auto;">
    üë§ Baza Klient√≥w
</button>
<button class="toolbar-btn" onclick="window.location.href='team.html'">
    üßë‚Äçü§ù‚Äçüßë Team Management
</button>
        </div>

        <!-- Chart -->
        <div class="chart-wrapper">
            <div class="chart-header">
                <div class="project-header">
                    <div class="header-column header-number">No.</div>
                    <div class="header-column-divider"></div>
                    <div class="header-column header-type">Type</div>
                    <div class="header-column-divider"></div>
                    <div class="header-column header-name">Project</div>
                    <div class="header-column-divider"></div>
                    <div class="header-column header-deadline">Deadline</div>
                    <div class="header-column-divider"></div>
                    <div class="header-column header-actions">Actions</div>
                </div>
                <div class="timeline-header" id="timelineHeader">
                    <!-- Timeline will be generated here -->
                </div>
            </div>
            <div class="chart-body" id="chartBody">
                <!-- Projects will be rendered here -->
            </div>
        </div>
    </div>

    <!-- Add/Edit Project Modal -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header" id="projectModalTitle">Add Project</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Project Number</label>
                    <input type="text" id="projectNumber" placeholder="e.g. 001/2025">
                </div>
                
                <div class="form-group">
                    <label>Project Type</label>
                    <div class="type-selector">
                        <div class="type-option" data-type="sash" onclick="selectProjectType('sash')">
                            <div class="type-icon">üî≤</div>
                            <div class="type-name">Sash Window</div>
                        </div>
                        <div class="type-option" data-type="casement" onclick="selectProjectType('casement')">
                            <div class="type-icon">üî≥</div>
                            <div class="type-name">Casement</div>
                        </div>
                        <div class="type-option" data-type="kitchen" onclick="selectProjectType('kitchen')">
                            <div class="type-icon">üç≥</div>
                            <div class="type-name">Kitchen</div>
                        </div>
                        <div class="type-option" data-type="wardrobe" onclick="selectProjectType('wardrobe')">
                            <div class="type-icon">üóÑÔ∏è</div>
                            <div class="type-name">Wardrobe</div>
                        </div>
                        <div class="type-option" data-type="partition" onclick="selectProjectType('partition')">
                            <div class="type-icon">üóÉÔ∏è</div>
                            <div class="type-name">Partition Wall</div>
                        </div>
                        <div class="type-option" data-type="externalSpray" onclick="selectProjectType('externalSpray')">
                            <div class="type-icon">üé®</div>
                            <div class="type-name">External Spray</div>
                        </div>
                        <div class="type-option" data-type="internalDoors" onclick="selectProjectType('internalDoors')">
                            <div class="type-icon">üö™</div>
                            <div class="type-name">Internal Doors</div>
                        </div>
                        <div class="type-option selected" data-type="other" onclick="selectProjectType('other')">
                            <div class="type-icon">üì¶</div>
                            <div class="type-name">Other</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Project Name</label>
                    <input type="text" id="projectName" placeholder="e.g. 4x Sash Windows">
                </div>
                
                <div class="form-group">
    <label>Klient (wymagany)</label>
    <select id="projectClient" style="width: 100%; padding: 8px; background: #3e3e42; border: 1px solid #555; color: #e8e2d5; border-radius: 3px;">
        <option value="">-- Wybierz klienta z bazy --</option>
    </select>
    <button type="button" onclick="window.open('clients.html', '_blank')" style="margin-top: 5px; padding: 5px 10px; background: #007acc; border: none; color: white; border-radius: 3px; cursor: pointer;">
        + Dodaj nowego klienta
    </button>
</div>
                
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="projectStartDate">
                </div>
                
                <div class="form-group">
                    <label>Deadline (optional - for production scheduling)</label>
                    <input type="date" id="projectDeadline">
                </div>
                
                <div class="form-group">
                    <label>Select Phases (uncheck unwanted phases)</label>
                    <div class="phase-list" id="phasesList">
                        <!-- Phase checkboxes will be added here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn" onclick="closeModal('projectModal')">Cancel</button>
                <button class="modal-btn primary" onclick="saveProject()">Save</button>
            </div>
        </div>
    </div>

    <!-- Phase Edit Modal -->
    <div class="modal" id="phaseEditModal">
        <div class="modal-content">
            <div class="modal-header" id="phaseEditTitle">Edit Phase</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Phase Status</label>
                    <select id="phaseStatus">
                        <option value="notStarted">‚è∏Ô∏è Not Started</option>
                        <option value="inProgress">‚ñ∂Ô∏è In Progress</option>
                        <option value="completed">‚úÖ Completed</option>
                        <option value="problem">‚ö†Ô∏è Problem/Delayed</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Duration (work days, excluding Sundays)</label>
                    <input type="number" id="phaseDuration" min="1" value="3">
                </div>
                
                <div class="form-group" id="assignSection" style="display: none;">
                    <label>Assign Team Member</label>
                    <select id="phaseAssignSelect">
                        <option value="">None</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="phaseNotes" placeholder="Add any notes about this phase..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn danger" id="deletePhaseBtn" onclick="deleteCurrentPhase()" style="margin-right: auto;">Delete Phase</button>
                <button class="modal-btn" onclick="closeModal('phaseEditModal')">Cancel</button>
                <button class="modal-btn primary" onclick="savePhaseChanges()">Save</button>
            </div>
        </div>
    </div>

    <!-- Order Materials Modal -->
    <div class="modal" id="orderMaterialsModal">
        <div class="modal-content">
            <div class="modal-header">Order Materials</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Duration (work days, excluding Sundays)</label>
                    <input type="number" id="orderDuration" min="1" value="3" oninput="saveOrderDuration()">
                </div>
                
                <div class="order-status-display" id="orderStatusText">
                    <!-- Status will be displayed here -->
                </div>
                
                <div class="form-group">
                    <label>Materials Checklist (* = required)</label>
                    <div class="materials-list" id="materialsList">
                        <!-- Materials will be listed here -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Add Custom Material</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newMaterialName" placeholder="Material name" style="flex: 1;">
                        <button class="modal-btn primary" onclick="addCustomMaterial()">Add</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn danger" onclick="deleteOrderPhase()" style="margin-right: auto;">Delete Phase</button>
                <button class="modal-btn" onclick="closeModal('orderMaterialsModal')">Close</button>
                <button class="modal-btn success" onclick="confirmOrderComplete()">Confirm Order Complete</button>
            </div>
        </div>
    </div>

    <!-- Order Spray Materials Modal -->
    <div class="modal" id="orderSprayModal">
        <div class="modal-content">
            <div class="modal-header">Order Spray Materials</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Duration (work days, excluding Sundays)</label>
                    <input type="number" id="sprayOrderDuration" min="1" value="2" oninput="saveSprayOrderDuration()">
                </div>
                
                <div class="order-status-display" id="sprayOrderStatusText">
                    <!-- Status will be displayed here -->
                </div>
                
                <div class="form-group">
                    <label>Spray Materials Checklist</label>
                    <div class="materials-list" id="sprayMaterialsList">
                        <!-- Spray materials will be listed here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn danger" onclick="deleteOrderSprayPhase()" style="margin-right: auto;">Delete Phase</button>
                <button class="modal-btn" onclick="closeModal('orderSprayModal')">Close</button>
                <button class="modal-btn success" onclick="confirmSprayOrderComplete()">Confirm Order Complete</button>
            </div>
        </div>
    </div>

    <!-- Order Glazing Modal -->
    <div class="modal" id="orderGlazingModal">
        <div class="modal-content">
            <div class="modal-header">Order Glazing</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Duration (work days, excluding Sundays)</label>
                    <input type="number" id="glazingOrderDuration" min="1" value="2" oninput="saveGlazingOrderDuration()">
                </div>
                
                <div class="order-status-display" id="glazingOrderStatusText">
                    <!-- Status will be displayed here -->
                </div>
                
                <div class="form-group">
                    <label>Glazing Materials Checklist</label>
                    <div class="materials-list" id="glazingMaterialsList">
                        <!-- Glazing materials will be listed here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn danger" onclick="deleteOrderGlazingPhase()" style="margin-right: auto;">Delete Phase</button>
                <button class="modal-btn" onclick="closeModal('orderGlazingModal')">Close</button>
                <button class="modal-btn success" onclick="confirmGlazingOrderComplete()">Confirm Order Complete</button>
            </div>
        </div>
    </div>

    <!-- Days Off Modal -->
    <div class="modal" id="daysOffModal">
        <div class="modal-content">
            <div class="modal-header">Days Off Management</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Mark Day Off</label>
                    <div style="display: flex; gap: 10px;">
                        <select id="daysOffMemberSelect" style="flex: 1;">
                            <option value="">Select member...</option>
                        </select>
                        <input type="date" id="daysOffDateInput">
                        <button class="modal-btn primary" onclick="markDayOffFromModal()">Add</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>All Days Off</label>
                    <div class="days-off-container" style="max-height: 400px; overflow-y: auto;">
                        <div id="daysOffListModal">
                            <!-- Days off list will be here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn primary" onclick="closeModal('daysOffModal')">Done</button>
            </div>
        </div>
    </div>

    <!-- Phase Manager Modal -->
    <div class="modal" id="phaseModal">
        <div class="modal-content">
            <div class="modal-header">Manage Phases</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Add Custom Phase</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newPhaseName" placeholder="Phase name">
                        <input type="color" id="newPhaseColor" value="#4a90e2">
                        <button class="modal-btn primary" onclick="addCustomPhase()">Add</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Available Phases</label>
                    <div id="availablePhases" style="max-height: 300px; overflow-y: auto;">
                        <!-- Phases list will be shown here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn primary" onclick="closeModal('phaseModal')">Done</button>
            </div>
        </div>
    </div>

   
    <!-- Move to Archive Modal -->
    <div class="modal" id="moveToArchiveModal">
        <div class="modal-content">
            <div class="modal-header">Move to Archive</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select Completed Project to Archive</label>
                    <select id="completedProjectSelect" style="width: 100%; padding: 8px;">
                        <option value="">Select project...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Archive Reason</label>
                    <select id="archiveReason" style="width: 100%; padding: 8px;">
                        <option value="completed">‚úÖ Project Completed Successfully</option>
                        <option value="cancelled">‚ùå Project Cancelled</option>
                        <option value="onHold">‚è∏Ô∏è Project On Hold</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Additional Notes (optional)</label>
                    <textarea id="archiveNotes" placeholder="Any additional notes about archiving this project..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn" onclick="closeModal('moveToArchiveModal')">Cancel</button>
                <button class="modal-btn success" onclick="confirmMoveToArchive()">Move to Archive</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" accept=".json" style="display: none;">

    <!-- Scripts in correct order -->
    <script src="js/utils.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/data.js"></script>
    <script src="js/team.js"></script>
    <script src="js/projects.js"></script>
    <script src="js/phases.js"></script>
    <script src="js/drag.js"></script>
    <script src="js/gantt.js"></script>
    <script src="js/modals.js"></script>
    <script src="js/order-duration-fixes.js"></script> 
    <script src="js/sticky-fix.js"></script>
    <script src="js/google-drive-picker.js"></script>
    <script src="js/app.js"></script>
</body>
</html>