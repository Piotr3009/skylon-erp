<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <title>TODAY - Daily Briefing - Joinery Core</title>
    <link rel="stylesheet" href="css/styles.css?v=11">
    
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
    <script src="js/config.js"></script>
    <script src="js/toast.js"></script>
    
    <style>
        /* ========== SCREEN STYLES ========== */
        html, body {
            height: auto;
            min-height: 100vh;
            overflow-y: auto;
        }
        
        .container {
            min-height: auto;
            overflow: visible;
        }
        
        .today-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .today-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #4a9eff;
        }
        
        .today-title {
            font-size: 32px;
            font-weight: 700;
            color: #4a9eff;
        }
        
        .today-date {
            font-size: 24px;
            color: #888;
        }
        
        .today-actions {
            display: flex;
            gap: 10px;
        }
        
        .today-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .today-btn.primary {
            background: #4a9eff;
            color: white;
        }
        
        .today-btn.secondary {
            background: #3e3e42;
            color: #e8e2d5;
        }
        
        .today-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        /* Grid layout */
        .today-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .today-section {
            background: #252526;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #3e3e42;
        }
        
        .today-section.full-width {
            grid-column: span 2;
        }
        
        .today-section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3e3e42;
        }
        
        .today-section-icon {
            font-size: 24px;
        }
        
        .today-section-title {
            font-size: 18px;
            font-weight: 600;
            color: #e8e2d5;
        }
        
        .today-section-badge {
            margin-left: auto;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-urgent {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        
        .badge-info {
            background: rgba(74, 158, 255, 0.2);
            color: #4a9eff;
        }
        
        .badge-success {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        /* Content items */
        .today-item {
            padding: 12px;
            margin-bottom: 10px;
            background: #1e1e1e;
            border-radius: 6px;
            border-left: 4px solid #3e3e42;
        }
        
        .today-item.urgent {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
        
        .today-item.warning {
            border-left-color: #f59e0b;
        }
        
        .today-item.success {
            border-left-color: #22c55e;
        }
        
        .today-item.info {
            border-left-color: #4a9eff;
        }
        
        .today-item-title {
            font-weight: 600;
            color: #e8e2d5;
            margin-bottom: 4px;
        }
        
        .today-item-subtitle {
            font-size: 13px;
            color: #888;
        }
        
        .today-item-meta {
            font-size: 12px;
            color: #666;
            margin-top: 6px;
        }
        
        /* Worker section */
        .today-worker {
            margin-bottom: 15px;
        }
        
        .today-worker-name {
            font-weight: 600;
            color: #4a9eff;
            margin-bottom: 8px;
            font-size: 15px;
        }
        
        .today-worker-tasks {
            padding-left: 15px;
        }
        
        .today-task {
            padding: 8px 12px;
            margin-bottom: 6px;
            background: #1e1e1e;
            border-radius: 4px;
            font-size: 13px;
            color: #e8e2d5;
        }
        
        .today-task.deadline-today {
            background: rgba(239, 68, 68, 0.15);
            border-left: 3px solid #ef4444;
        }
        
        .today-task.starts-tomorrow {
            background: rgba(34, 197, 94, 0.15);
            border-left: 3px solid #22c55e;
        }
        
        /* Checklist */
        .today-checklist {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .today-check-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #1e1e1e;
            border-radius: 6px;
            font-size: 14px;
            color: #e8e2d5;
        }
        
        .today-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid #4a9eff;
            border-radius: 4px;
            flex-shrink: 0;
        }
        
        /* Empty state */
        .today-empty {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
        
        /* Monday only badge */
        .monday-only {
            font-size: 10px;
            background: #3e3e42;
            color: #888;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 10px;
        }
        
        /* Loading */
        .today-loading {
            text-align: center;
            padding: 60px;
            color: #888;
        }
        
        .today-loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #3e3e42;
            border-top-color: #4a9eff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ========== PRINT STYLES (A3) ========== */
        @media print {
            @page {
                size: A3 portrait;
                margin: 15mm;
            }
            
            body {
                background: white !important;
                color: black !important;
                font-size: 11pt;
            }
            
            .header, .today-actions, .no-print {
                display: none !important;
            }
            
            .today-container {
                max-width: 100%;
                padding: 0;
            }
            
            .today-header {
                border-bottom: 2px solid black;
                margin-bottom: 15px;
                padding-bottom: 10px;
            }
            
            .today-title {
                color: black !important;
                font-size: 28pt;
            }
            
            .today-date {
                color: #333 !important;
                font-size: 16pt;
            }
            
            .today-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .today-section {
                background: white !important;
                border: 1px solid #ccc;
                padding: 12px;
                break-inside: avoid;
            }
            
            .today-section-header {
                border-bottom: 1px solid #ccc;
            }
            
            .today-section-title {
                color: black !important;
                font-size: 14pt;
            }
            
            .today-item, .today-task, .today-check-item {
                background: #f5f5f5 !important;
                color: black !important;
                border: 1px solid #ddd;
            }
            
            .today-item-title, .today-worker-name {
                color: black !important;
            }
            
            .today-item-subtitle, .today-item-meta {
                color: #555 !important;
            }
            
            .today-checkbox {
                border: 2px solid black;
            }
            
            .badge-urgent, .badge-warning, .badge-info, .badge-success {
                border: 1px solid currentColor;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header no-print">
            <div class="app-title">üìÖ TODAY - Daily Briefing</div>
            <div class="navigation-links"></div>
        </div>
        
        <!-- Today Content -->
        <div class="today-container">
            <!-- Today Header -->
            <div class="today-header">
                <div>
                    <div class="today-title">üìÖ TODAY</div>
                    <div class="today-date" id="todayDate">Loading...</div>
                </div>
                <div class="today-actions no-print">
                    <button class="today-btn secondary" onclick="window.location.href='index.html'">‚Üê Back</button>
                    <button class="today-btn secondary" onclick="openManageEvents()">‚öôÔ∏è Manage Events</button>
                    <button class="today-btn primary" onclick="window.print()">üñ®Ô∏è Print</button>
                </div>
            </div>
            
            <!-- Loading -->
            <div class="today-loading" id="todayLoading">
                <div class="today-loading-spinner"></div>
                <div>Loading daily briefing...</div>
            </div>
            
            <!-- Grid -->
            <div class="today-grid" id="todayGrid" style="display: none;">
                
                <!-- PRODUCTION -->
                <div class="today-section">
                    <div class="today-section-header">
                        <span class="today-section-icon">ü™µ</span>
                        <span class="today-section-title">PRODUCTION</span>
                        <span class="today-section-badge badge-info" id="badgeProduction">0</span>
                    </div>
                    <div id="sectionProduction">
                        <div class="today-empty">No production tasks today</div>
                    </div>
                </div>
                
                <!-- SPRAYING -->
                <div class="today-section">
                    <div class="today-section-header">
                        <span class="today-section-icon">üé®</span>
                        <span class="today-section-title">SPRAYING</span>
                        <span class="today-section-badge badge-info" id="badgeSpraying">0</span>
                    </div>
                    <div id="sectionSpraying">
                        <div class="today-empty">No spraying tasks today</div>
                    </div>
                </div>
                
                <!-- MEETINGS & REMINDERS -->
                <div class="today-section">
                    <div class="today-section-header">
                        <span class="today-section-icon">üóìÔ∏è</span>
                        <span class="today-section-title">MEETINGS & REMINDERS</span>
                    </div>
                    <div id="sectionMeetings">
                        <div class="today-empty">No meetings today</div>
                    </div>
                </div>
                
                <!-- HOLIDAYS -->
                <div class="today-section">
                    <div class="today-section-header">
                        <span class="today-section-icon">üèñÔ∏è</span>
                        <span class="today-section-title">HOLIDAYS TODAY</span>
                    </div>
                    <div id="sectionHolidays">
                        <div class="today-empty">Everyone is working today</div>
                    </div>
                </div>
                
                <!-- STOCK ALERTS -->
                <div class="today-section">
                    <div class="today-section-header">
                        <span class="today-section-icon">üì¶</span>
                        <span class="today-section-title">STOCK ALERTS</span>
                        <span class="today-section-badge badge-urgent" id="badgeStock" style="display: none;">0</span>
                    </div>
                    <div id="sectionStock">
                        <div class="today-empty">Stock levels OK</div>
                    </div>
                </div>
                
                <!-- FLEET & EQUIPMENT -->
                <div class="today-section">
                    <div class="today-section-header">
                        <span class="today-section-icon">üöê</span>
                        <span class="today-section-title">FLEET & EQUIPMENT</span>
                    </div>
                    <div id="sectionFleet">
                        <div class="today-empty">No alerts</div>
                    </div>
                </div>
                
                <!-- OFFICE - Daily -->
                <div class="today-section">
                    <div class="today-section-header">
                        <span class="today-section-icon">üóÇÔ∏è</span>
                        <span class="today-section-title">OFFICE</span>
                        <span class="today-section-badge badge-info" id="badgeOfficeDaily">0</span>
                    </div>
                    <div id="sectionOfficeDaily">
                        <div class="today-empty">No office tasks today</div>
                    </div>
                </div>
                
                <!-- PIPELINE REVIEW - only Monday -->
                <div class="today-section" id="sectionPipelineWrapper" style="display: none;">
                    <div class="today-section-header">
                        <span class="today-section-icon">üìã</span>
                        <span class="today-section-title">PIPELINE - WEEKLY REVIEW</span>
                        <span class="monday-only">Monday only</span>
                    </div>
                    <div id="sectionPipeline">
                        <div class="today-empty">No items to review</div>
                    </div>
                </div>
                
                <!-- THIS WEEK DEADLINES -->
                <div class="today-section">
                    <div class="today-section-header">
                        <span class="today-section-icon">üìÖ</span>
                        <span class="today-section-title">THIS WEEK DEADLINES</span>
                    </div>
                    <div id="sectionWeek">
                        <div class="today-empty">No deadlines this week</div>
                    </div>
                </div>
                
                <!-- DAILY CHECKLIST -->
                <div class="today-section full-width">
                    <div class="today-section-header">
                        <span class="today-section-icon">‚úÖ</span>
                        <span class="today-section-title">END OF DAY CHECKLIST</span>
                    </div>
                    <div class="today-checklist">
                        <div class="today-check-item">
                            <div class="today-checkbox"></div>
                            <span>Workshop cleaned</span>
                        </div>
                        <div class="today-check-item">
                            <div class="today-checkbox"></div>
                            <span>All machines OFF</span>
                        </div>
                        <div class="today-check-item">
                            <div class="today-checkbox"></div>
                            <span>Dust bags emptied</span>
                        </div>
                        <div class="today-check-item">
                            <div class="today-checkbox"></div>
                            <span>Alarm ON</span>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
    
    <!-- Manage Events Modal -->
    <div class="modal" id="manageEventsModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>‚öôÔ∏è Manage Recurring Events</h2>
                <button class="modal-close" onclick="closeManageEvents()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="eventsList" style="margin-bottom: 20px;">
                    <!-- Events will be loaded here -->
                </div>
                
                <div style="border-top: 1px solid #3e3e42; padding-top: 20px;">
                    <h3 style="margin-bottom: 15px; color: #e8e2d5;">Add New Event</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; color: #888; font-size: 12px;">Title</label>
                            <input type="text" id="eventTitle" class="form-input" placeholder="Event title">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; color: #888; font-size: 12px;">Day of Week</label>
                            <select id="eventDay" class="form-input">
                                <option value="1">Monday</option>
                                <option value="2">Tuesday</option>
                                <option value="3">Wednesday</option>
                                <option value="4">Thursday</option>
                                <option value="5">Friday</option>
                                <option value="6">Saturday</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; color: #888; font-size: 12px;">Time (optional)</label>
                            <input type="time" id="eventTime" class="form-input">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; color: #888; font-size: 12px;">Section</label>
                            <select id="eventSection" class="form-input">
                                <option value="general">General</option>
                                <option value="production">Production</option>
                                <option value="spraying">Spraying</option>
                                <option value="office">Office</option>
                            </select>
                        </div>
                        <div style="grid-column: span 2;">
                            <label style="display: block; margin-bottom: 5px; color: #888; font-size: 12px;">Description (optional)</label>
                            <input type="text" id="eventDescription" class="form-input" placeholder="Additional details">
                        </div>
                        <div style="grid-column: span 2;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="eventShowDayBefore">
                                <span style="color: #888; font-size: 13px;">Show reminder day before</span>
                            </label>
                        </div>
                    </div>
                    <button class="modal-btn primary" onclick="addEvent()" style="margin-top: 15px;">+ Add Event</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="js/menu.js"></script>
    <script src="js/today.js"></script>
</body>
</html>